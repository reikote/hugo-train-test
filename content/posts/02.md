---
title: "SWのインストールと設定"
date: 2020-12-22T12:11:23+09:00
draft: true
weight: 3
---

## 環境構築に必要なソフトウェア
まずは下記のソフトウェアをインストールします。それぞれのインストール手順も記載しています。

### マスター
| Software | Version | Version Info | 
| -------- | --------- |------------|
| Docker | 19.03.09 |https://docs.docker.com/engine/release-notes/|
| docker-compose | 1.28.2 |https://docs.docker.com/compose/release-notes/|
| kubectl    | 1.20 |https://kubernetes.io/ja/docs/tasks/tools/install-kubectl/#|
| helm    | 3.x |https://github.com/helm/helm/releases|

##### コンテナで実行
| Software | Version | Version Info | 
| -------- | ---------------------- |------|
| Rancher | 2.4.8 |https://rancher.com/support-maintenance-terms/all-supported-versions/rancher-v2.4.8/|
| Harbor | 1.10.5 |https://github.com/goharbor/harbor/releases|

### ワーカー
| Software | Version | Version Info | 
| -------- | ---------------------- |------|
| Docker | 19.03.09 |https://docs.docker.com/engine/release-notes/|
| docker-compose | 1.28.2 |https://docs.docker.com/compose/release-notes/|
| nvidia-docker2 | 2.x |https://github.com/NVIDIA/nvidia-docker|


{{% notice note %}}
ソフトウェアの対応Versionを確認することはとても大事です。
例えばRancherの最新バージョンは、Dockerの最新バージョンに対応していません。(21年2月調べ)
使用するソフトウェアの互換性を必ず確認してください。
{{% /notice %}}

## Docker
***
#### インストール手順
※[こちら](https://docs.docker.com/engine/install/ubuntu/)を参考
マスター・ワーカーにインストール

* セットアップ
```
$ sudo apt-get update

$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common
    
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

$ sudo apt-key fingerprint 0EBFCD88

$ sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
```

* Dockerエンジンのインストール
※最新Versionでは、Rancherが対応していないケースがあるので注意　対応Versionを必ず調べること

```
$ sudo apt-get update
$ sudo apt-get install docker-ce docker-ce-cli containerd.io
```
* 19.03.9なら
```
$ apt-cache madison docker-ce
$ sudo apt-get install docker-ce=5:19.03.9~3-0~ubuntu-bionic docker-ce-cli=5:19.03.9~3-0~ubuntu-bionic containerd.io
$ docker --version
## Docker version 19.03.9, build 9d988398e7
```



* テスト実行してみる
```
$ sudo docker run hello-world
```

* sudoが面倒な場合
```
$ sudo usermod -aG docker <your-user>
```

## Docker Compose
***
#### インストール手順
※[こちら](https://docs.docker.com/compose/install/)を参考
マスター・ワーカーにインストール

* インストール
```
$ sudo curl -L "https://github.com/docker/compose/releases/download/1.28.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

$ sudo curl -L "https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
$ sudo chmod +x /usr/local/bin/docker-compose
$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
$ docker-compose --version
```

## Kubectl
***
#### インストール手順
※[こちら](https://kubernetes.io/ja/docs/tasks/tools/install-kubectl/)を参考
マスターにインストール

```
$ curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"
$ chmod +x ./kubectl
$ sudo mv ./kubectl /usr/local/bin/kubectl
$ kubectl version --client
```


## Helm
***
#### インストール手順
※[こちら](https://helm.sh/docs/intro/install/)を参考

```
$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
$ chmod 700 get_helm.sh
$ ./get_helm.sh
```

## nvidia-docker2
***
#### インストール手順
※[こちら](https://docs.nvidia.com/datacenter/cloud-native/kubernetes/dcgme2e.html#install-nvidia-container-toolkit-previously-nvidia-docker2)を参考
ワーカーにインストール

```
$ distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
   && curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - \
   && curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

$ sudo apt-get update \
   && sudo apt-get install -y nvidia-docker2

$ sudo vim /etc/docker/daemon.json
 {
   "default-runtime": "nvidia",
   "runtimes": {
        "nvidia": {
            "path": "/usr/bin/nvidia-container-runtime",
            "runtimeArgs": []
      }
   }
}

$ sudo systemctl restart docker
$ sudo docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
```




