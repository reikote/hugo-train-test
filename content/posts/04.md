---
title: "Harborとの連携"
date: 2020-12-22T12:11:23+09:00
draft: true
weight: 5
---

## Harbor
***
#### インストール手順
※[こちら](https://goharbor.io/docs/1.10/install-config/)を参考

* TLS無しセットアップ
```
$ wget https://github.com/goharbor/harbor/releases/download/v1.10.5/harbor-offline-installer-v1.10.5.tgz

$ tar xzvf./harbor-offline-installer-v1.10.5.tgz

$ cd harbor

$ vim harbor.yml

# 以下のように編集 IPアドレスはMasterノード
Hostname:192.168.100.xxx
http:
Port:80 # ここがalready useとなる場合、5000等にする

harbor_admin_passwd: password
# 下の部分はTLS絡みのため、コメントアウトした
# https:
# Ports:443
# certificate:
# private_key:

$ sudo ./install.sh
```

* Dockerに暗号化通信の利用無に関する設定を事前にやっておく必要がある (Master/Workerどちらも)

※[参考](https://www.itmedia.co.jp/enterprise/articles/1708/25/news014_2.html)

```
$ sudo vim /etc/docker/daemon.json

{ "insecure-registries":[”192.168.100.xxx(80以外なら:portも追加)"] }
##プライベートレジストリのIPアドレス

$ sudo systemctl restart docker
```
* ハーバーにログイン
http://192.168.100.xxx:xxxx/

admin
password

![](/images/harborlogin.PNG?height=400px)


* トラブルシューティング コンテナの停止方法等
※[参考](https://goharbor.io/docs/1.10/install-config/reconfigure-manage-lifecycle/)

ハーバーを再構成する
```
$ sudo docker-compose down -v
$ vim harbor.yml
$ sudo prepare
$ sudo docker-compose up -d
```

docker-compose up -d デタッチド・モード: バックグラウンドでコンテナを実行し、新しいコンテナ名を表示
                　　--abort-on-container-exit と同時に使えない
docker-compose down -v composeファイルの'volume'セクションの名前付きのボリュームを削除 (コンテナがアタッチしたものも)


##



